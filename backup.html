<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
      integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
  </head>

  <style>
    .form-body {
      max-width: 500px;
      margin: auto;
    }
    .a {
      display: table-row;
    }
    .a div {
      display: table-cell;
      padding-right: 15px;
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    function generatePDF() {
      // Choose the element that our invoice is rendered in.
      const element = document.getElementById('pdfView');
      // Choose the element and save the PDF for our user.
      var options = {
        margin: 1,
        filename: 'isolates.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
      };
      html2pdf(element, options).save();
    }
  </script>

  <script>
    function addItem(e) {
      e.preventDefault();
      const myElement = document.querySelector('#itemList');
      const node = document.querySelector('.item').cloneNode(true);
      myElement.appendChild(node);
    }

    function isOdd(x) {
      return x & 1 ? true : false;
    }

    function toPdf() {
      html2canvas(document.querySelector('#pdfView'), {
        onrendered: function (canvas) {
          var img = canvas.toDataURL('image/png');
          var doc = new jsPDF();
          doc.addImage(img, 'JPEG', 20, 20);
          // doc.save('test.pdf');
          window.open(doc.output('bloburl'));
        },
      });

      // var doc = new jsPDF();
      // var elementHTML = document.querySelector('#pdfView');
      // // var specialElementHandlers = {
      // //   '#elementH': function (element, renderer) {
      // //     return true;
      // //   },
      // // };
      // doc.fromHTML(elementHTML, 5, 5, {
      //   format: 'credit-card',
      // });

      // // Save the PDF
      // // doc.save('sample-document.pdf');

      // // doc.output('dataurlnewwindow');
      // window.open(doc.output('bloburl'));
    }

    function totalAmount(meal) {
      meal.redu;
    }

    function handlesubmit(e) {
      e.preventDefault();
      const formData = new FormData(e.target);

      let i = 1;
      let itemNum = 0;
      let orderedMeal = [];

      for (var value of formData.values()) {
        if (isOdd(i)) {
          orderedMeal[itemNum] = {};
          orderedMeal[itemNum]['item'] = value;
          i++;
        } else {
          orderedMeal[itemNum]['price'] = value;
          itemNum++;
          i++;
        }
      }
      console.log(orderedMeal);

      let tableBody =
        '<table class="table table-striped" style="text-align: left">\
          <thead>\
            <tr>\
              <th>Sl</th>\
              <th>Item</th>\
              <th>Amount</th>\
            </tr>\
          </thead>';

      tableBody += orderedMeal.reduce((total, currentValue, index) => {
        let row =
          '<tr><td>' +
          (index + 1) +
          '</td><td>' +
          currentValue.item +
          '</td><td>' +
          Number(currentValue.price).toFixed(2) +
          '</td>/</tr>';
        return total + row;
      }, '');

      const totalAmount = orderedMeal.reduce((total, currentValue, index) => {
        return total + Number(currentValue.price);
      }, 0);

      tableBody +=
        ' <tr><td></td><td style="font-weight: bold;">Subtotal</td><td style="font-weight: bold;">' +
        totalAmount.toFixed(2) +
        ' BDT</td></tr>';

      tableBody += '</table>';

      console.log(tableBody);
      document.getElementById('address').style.display = 'block';
      document.getElementById('table').innerHTML = tableBody;

      toPdf();
    }
  </script>

  <body>
    <nav
      class="navbar navbar-dark bg-primary"
      aria-label="First navbar example"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Never expand</a>
      </div>
    </nav>

    <div
      class="container form-body"
      style="width: 550px; height: 770px; text-align: center"
    >
      <form onsubmit="handlesubmit(event)">
        <div id="itemList">
          <div class="row item">
            <div class="col col-8">
              <div class="mb-3">
                <label for="mealInput" class="form-label">Select Item</label>

                <select
                  class="form-select"
                  aria-label="Default select example"
                  name="item1"
                >
                  <option selected>Select item</option>
                  <option value="Plain Rice">Plain Rice</option>
                  <option value="Polao">Polao</option>
                  <option value="Beef Biriyani">Beef Biriyani</option>
                  <option value="Chicken Biriyani">Chicken Biriyani</option>
                  <option value="Beef Curry">Beef Curry</option>
                  <option value="Chicken Curry">Chicken Curry</option>
                  <option value="Mutton Curry">Mutton Curry</option>
                  <option value="Dal">Dal</option>
                  <option value="Vorta">Vorta</option>
                  <option value="Vegetable">Vegetable</option>
                </select>
              </div>
            </div>

            <div class="col col-4">
              <div class="mb-3">
                <label for="mealPrice" class="form-label">Price</label>
                <input
                  type="number"
                  class="form-control"
                  id="exampleInputPassword1"
                  name="price1"
                />
              </div>
            </div>
          </div>
        </div>

        <button class="btn btn-primary" onclick="addItem(event)">
          Add another item
        </button>
        <button type="submit" class="btn btn-primary">Submit</button>

        <button onclick="generatePDF()">Download as PDF</button>
      </form>
      <div id="pdfView">
        <div id="address" style="display: none; margin-top: 24px">
          <h5>Monjurul Beverage Ltd.</h5>
          <div>House:11, Road:7, Block: A</div>
          <div>Banasri, Dhaka-1212</div>
          <div>Mobile: 01711-086137</div>
          <div>Bill no: Dummy</div>
          <div id="date"></div>
        </div>

        <div id="table"></div>

        <h5>Thank You!</h5>
      </div>
    </div>
  </body>
  <script>
    console.log('aa');
    const d = new Date();
    let date = d.toLocaleString();

    console.log(date);

    document.getElementById('date').innerHTML = 'Date: ' + date;
  </script>
</html>
